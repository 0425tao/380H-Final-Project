<!DOCTYPE html>
<html>
<head>
    <style>
    
body {
    font-size: 1rem;
    font-family: 'Open Sans', sans-serif;
    font-weight: 400;
    fill: #8C8C8C;
    text-align: center;
}
.timeLabel,
.dayLabel {
    font-size: 1.6rem;
    fill: #AAAAAA;
    font-weight: 300;
}
text.axis-workweek,
text.axis-worktime {
    fill: #404040;
    font-weight: 400;
}
.title {
    font-size: 2.8rem;
    fill: #4F4F4F;
    font-weight: 300;
}
.subtitle {
    font-size: 1.4rem;
    fill: #AAAAAA;
    font-weight: 300;
}
.credit {
    font-size: 1.2rem;
    fill: #AAAAAA;
    font-weight: 400;
}
.axis path,
.axis tick,
.axis line {
    fill: none;
    stroke: none;
}
text {
    font-size: 1.2rem;
    fill: #AAAAAA;
    font-weight: 400;
}
.legendTitle {
    font-size: 1.5rem;
    fill: #4F4F4F;
    font-weight: 300;
}

#container {
  margin-left:auto;
  margin-right:auto;
  display:center;
  width:1000px;
  height:800px;
  margin-bottom: 5px;
  overflow: hidden;
  border: 1px solid silver;
  border-radius: 6px;
  background: white;
}

.zoom-button {
  width: 30px;
  height: 30px;
  border-radius: 4px;
  border: none;
  background: silver;
  font-size: 16px;
  color: white;
  cursor: pointer;
}

#zoom-info {
  display: inline-block;
  padding: 10px;
}

.affix {
      top: 0;
      width: 100%;
      -webkit-transition: all .5s ease-in-out;
      transition: all .5s ease-in-out;
      background-color: rgba(15, 155, 179, 0.58);
      border-color: rgba(15, 155, 179, 1);

  }
.affix a {
      color: #fff !important;
      padding: 15px !important;
      -webkit-transition: all .5s ease-in-out;
      transition: all .5s ease-in-out;
  }
.affix-top a {
      padding: 15px !important;
  }
  
</style>

<script src="./d3.min.js"></script>
<script src="./topojson.min.js"></script>
<script src="./worldmap.js"></script>
<script src="./jquery.min.js"></script>
<link href="./styles/bootstrap.min.css" rel="stylesheet">
<script src="./bootstrap.min.js"></script>
<link href="./append.css" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
 </head>
 
 <body>
 <header style="height:400px;
          background-image: url(./images/Globe-Internet.jpg);
		   background-size: cover;background-position:15% 40%">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="site-heading" style="margin-top:100px;">
                        <h1 style="font-size:70px;color:rgba(200,200,200,1);">Internet Freedom</h1>
                        <hr class="small">
                        <span class="subheading" style="font-size:40px;color:rgba(145,145,145,0.8);">COMP 380H Project</span>
                    </div>
                </div>
            </div>
        </div>
</header>
<div style="background-color:#e2e2e2;">
 <nav class="navbar" data-spy="affix" data-offset-top="400" style="z-index:2;">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="./index.html">Home</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="#">Page1</a></li>
		<li><a href="#">Page2</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Special cases <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Country1</a></li>
            <li><a href="#">Country2</a></li>
            <li><a href="#">Country3</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Country4</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Country5</a></li>
          </ul>
        </li>
      </ul>
	  
      <ul class="nav navbar-nav navbar-left">
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" 
		  role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</div>

<div style="position: absolute;left:50px;top:470px; ">
<div id="container" style="position:relative;margin-left:30px;margin-right:auto;width: 1100px; height: 560px;"></div>

<button class="zoom-button" data-zoom="reset">0</button>
<button class="zoom-button" data-zoom="out">-</button>
<button class="zoom-button" data-zoom="in">+</button>
<div id="zoom-info" style="font-size:15px;"></div>
<div id="legend" style="position:absolute;left:330px;top:470px;"></div>
<script src="./legend.js"></script>

<div class="container-fluid" style="height:1000px">
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
  <h1>Some text to enable scrolling</h1>
</div>

<div id="plotly-div" style="width:800px;height:400px;"></div>
</div>

<script>
var paletteScale = d3.scale.linear()
            .domain([6,88])
            .range(["#EFEFFF","#02386F"]); 
			
var numberarray= ['6', '6', '16', '18', '19', '21', '22', '23', '25', '25', '25', '25', '26', '27', '27', '29', '30', '32', '32', '34', '35', '36', '38', '38', '38', '38', '40', '41', '41', '41', '41', '42', '44', '44', '44', '45', '45', '51', '51', '52', '56', '56', '57', '58', '60', '61', '61', '63', '63', '63', '64', '65', '66', '67', '68', '69', '71', '72', '76', '79', '79', '83', '87', '87', '88']; 
var colorarray=[];
for (var i=0; i<numberarray.length; i++) {
			colorarray[i]=paletteScale(parseInt(numberarray[i]));
		}
trace1 = {
  x: ['Estonia', 'Iceland', 'Canada', 'USA', 'Germany', 'Australia', 'Japan', 'United Kingdom', 'France', 'Georgia', 'Italy', 'South Africa', 'Philippine', 'Argentina', 'Hungary', 'Kenya', 'Armenia', 'Brazil', 'Colombia', 'Nigeria', 'Kyrgyzstan', 'South Korea', 'Mexico', 'Tunisia', 'Ukraine', 'Zambia', 'Angola', 'Ecuador', 'India', 'Malawi', 'Singapore', 'Uganda', 'Indonesia', 'Morocco', 'Sri Lanka', 'Lebanon', 'Malaysia', 'Jordan', 'Rwanda', 'Cambodia', 'Bangladesh', 'Zimbabwe', 'Azrbaijan', 'Lybia', 'Venezuela', 'Myanmar', 'Turkey', 'Belarus', 'Egypt', 'Kazakhistan', 'Sudan', 'Russia', 'Thailand', 'Gambia', 'UAE', 'Pakistan', 'Baharan', 'Saudi Arab', 'Vietnam', 'Cuba', 'Uzbekistan', 'Ethiopia', 'Iran', 'Syria', 'China'], 
  y: ['6', '6', '16', '18', '19', '21', '22', '23', '25', '25', '25', '25', '26', '27', '27', '29', '30', '32', '32', '34', '35', '36', '38', '38', '38', '38', '40', '41', '41', '41', '41', '42', '44', '44', '44', '45', '45', '51', '51', '52', '56', '56', '57', '58', '60', '61', '61', '63', '63', '63', '64', '65', '66', '67', '68', '69', '71', '72', '76', '79', '79', '83', '87', '87', '88'], 
  marker: {color: colorarray}, 
  name: 'Column 1', 
  type: 'bar', 
  uid: '9dd475'
};
data = [trace1];
layout = {
  autosize: true, 
  hovermode: 'closest', 
  margin: {
    r: 80, 
    b: 100, 
    l: 80, 
    pad: 0
  }, 
  title: 'Internet Freedom 2016', 
  xaxis: {
    autorange: true, 
    range: [-0.5, 64.5], 
    title: 'Country', 
    type: 'category'
  }, 
  yaxis: {
    autorange: false, 
    range: [0, 90], 
    title: 'Score', 
    type: 'linear'
  }
};
Plotly.plot('plotly-div', {
  data: data,
  layout: layout
});
</script>

<script>
function Zoom(args) {
  $.extend(this, {
    $buttons:   $(".zoom-button"),
    $info:      $("#zoom-info"),
    scale:      { max: 50, currentShift: 0 },
    $container: args.$container,
    datamap:    args.datamap
  });

  this.init();
}

Zoom.prototype.init = function() {
  var paths = this.datamap.svg.selectAll("path"),
      subunits = this.datamap.svg.selectAll(".datamaps-subunit");

  // preserve stroke thickness
  paths.style("vector-effect", "non-scaling-stroke");

  // disable click on drag end
  subunits.call(
    d3.behavior.drag().on("dragend", function() {
      d3.event.sourceEvent.stopPropagation();
    })
  );

  this.scale.set = this._getScalesArray();
  this.d3Zoom = d3.behavior.zoom().scaleExtent([ 1, this.scale.max ]);

  this._displayPercentage(1);
  this.listen();
};

Zoom.prototype.listen = function() {
  this.$buttons.off("click").on("click", this._handleClick.bind(this));

  this.datamap.svg
    .call(this.d3Zoom.on("zoom", this._handleScroll.bind(this)))
    .on("dblclick.zoom", null); // disable zoom on double-click
};

Zoom.prototype.reset = function() {
  this._shift("reset");
};

Zoom.prototype._handleScroll = function() {
  var translate = d3.event.translate,
      scale = d3.event.scale,
      limited = this._bound(translate, scale);

  this.scrolled = true;

  this._update(limited.translate, limited.scale);
};

Zoom.prototype._handleClick = function(event) {
  var direction = $(event.target).data("zoom");

  this._shift(direction);
};

Zoom.prototype._shift = function(direction) {
  var center = [ this.$container.width() / 2, this.$container.height() / 2 ],
      translate = this.d3Zoom.translate(), translate0 = [], l = [],
      view = {
        x: translate[0],
        y: translate[1],
        k: this.d3Zoom.scale()
      }, bounded;

  translate0 = [
    (center[0] - view.x) / view.k,
    (center[1] - view.y) / view.k
  ];

	if (direction == "reset") {
  	view.k = 1;
    this.scrolled = true;
  } else {
  	view.k = this._getNextScale(direction);
  }

l = [ translate0[0] * view.k + view.x, translate0[1] * view.k + view.y ];

  view.x += center[0] - l[0];
  view.y += center[1] - l[1];

  bounded = this._bound([ view.x, view.y ], view.k);

  this._animate(bounded.translate, bounded.scale);
};

Zoom.prototype._bound = function(translate, scale) {
  var width = this.$container.width(),
      height = this.$container.height();

  translate[0] = Math.min(
    (width / height)  * (scale - 1),
    Math.max( width * (1 - scale), translate[0] )
  );

  translate[1] = Math.min(0, Math.max(height * (1 - scale), translate[1]));

  return { translate: translate, scale: scale };
};

Zoom.prototype._update = function(translate, scale) {
  this.d3Zoom
    .translate(translate)
    .scale(scale);

  this.datamap.svg.selectAll("g")
    .attr("transform", "translate(" + translate + ")scale(" + scale + ")");

  this._displayPercentage(scale);
};

Zoom.prototype._animate = function(translate, scale) {
  var _this = this,
      d3Zoom = this.d3Zoom;

  d3.transition().duration(350).tween("zoom", function() {
    var iTranslate = d3.interpolate(d3Zoom.translate(), translate),
        iScale = d3.interpolate(d3Zoom.scale(), scale);

		return function(t) {
      _this._update(iTranslate(t), iScale(t));
    };
  });
};

Zoom.prototype._displayPercentage = function(scale) {
  var value;

  value = Math.round(Math.log(scale) / Math.log(this.scale.max) * 100);
  this.$info.text(value + "%");
};

Zoom.prototype._getScalesArray = function() {
  var array = [],
      scaleMaxLog = Math.log(this.scale.max);

  for (var i = 0; i <= 10; i++) {
    array.push(Math.pow(Math.E, 0.1 * i * scaleMaxLog));
  }

  return array;
};

Zoom.prototype._getNextScale = function(direction) {
  var scaleSet = this.scale.set,
      currentScale = this.d3Zoom.scale(),
      lastShift = scaleSet.length - 1,
      shift, temp = [];

  if (this.scrolled) {

    for (shift = 0; shift <= lastShift; shift++) {
      temp.push(Math.abs(scaleSet[shift] - currentScale));
    }

    shift = temp.indexOf(Math.min.apply(null, temp));

    if (currentScale >= scaleSet[shift] && shift < lastShift) {
      shift++;
    }

    if (direction == "out" && shift > 0) {
      shift--;
    }

    this.scrolled = false;

  } else {

    shift = this.scale.currentShift;

    if (direction == "out") {
      shift > 0 && shift--;
    } else {
      shift < lastShift && shift++;
    }
  }

  this.scale.currentShift = shift;

  return scaleSet[shift];
};
</script>

<script>
    // example data from server
   var series = [
        ["AGO",40],["ARG",37],["ARM",30],["AUS",21],["AZE",57],["BHR",71],
        ["BGD",56],["BLR",63],["BRA",32],["KHM",52],["CAN",16],["CHN",88],
        ["COL",32],["CUB",79],["ECU",41],["EGY",63],["EST",6],["ETH",83],
        ["FRA",25],["GMB",67],["GEO",25],["DEU",19],["HUN",27],["ISL",6],
        ["IND",41],["IDN",44],["IRN",87],["ITA",25],["JPN",22],["JOR",51],
        ["KAZ",63],["KEN",29],["KGZ",35],["LBN",45],["LBY",58],["MWI",41],
		["MYS",45],["MEX",38],["MAR",44],["MMR",61],["NGA",34],["PAK",69],
		["PHL",26],["RUS",65],["RWA",51],["SAU",72],["SGP",41],["ZAF",25],
		["KOR",36],["LKA",44],["SDN",64],["SYR",87],["THA",66],["TUN",38],
		["TUR",61],["UGA",42],["UKR",38],["ARE",68],["GBR",23],["USA",18],
		["UZB",79],["VEN",60],["VNM",76],["ZMB",38],["ZWE",56]];
    // Datamaps expect data in format:
    // { "USA": { "fillColor": "#42a844", numberOfWhatever: 75},
    //   "FRA": { "fillColor": "#8dc386", numberOfWhatever: 43 } }
    var dataset = {};
    // We need to colorize every country based on "numberOfWhatever"
    // colors should be uniq for every value.
    // For this purpose we create palette(using min/max series-value)
    var onlyValues = series.map(function(obj){ return obj[1]; });
    var minValue = Math.min.apply(null, onlyValues),
            maxValue = Math.max.apply(null, onlyValues);
    // create color palette function
    // color can be whatever you wish
    var paletteScale = d3.scale.linear()
            .domain([minValue,maxValue])
            .range(["#EFEFFF","#02386F"]); // blue color
    // fill dataset in appropriate format
    series.forEach(function(item){ //
        // item example value ["USA", 70]
        var iso = item[0],
                value = item[1];
        dataset[iso] = { numberOfThings: value, fillColor: paletteScale(value) };
    });

</script>

<script>
function Datamap() {
	this.$container = $("#container");
	this.instance = new Datamaps({
    scope: 'world',
    element: this.$container.get(0),
    fills: { defaultFill: '#F5F5F5' },
	data: dataset,
    geographyConfig: {
            borderColor: '#DEDEDE',
            highlightBorderWidth: 2,
            // don't change color on mouse hover
            highlightFillColor: function(geo) {
                return geo['fillColor'] || '#F5F5F5';
            },
            // only change border
            highlightBorderColor: '#B7B7B7',
            // show desired information in tooltip
            popupTemplate: function(a, b) {
		if (!b) {return '<div class="hoverinfo"><strong>' + a.properties.name + '<br>'+'Freedom Score unavailable'+'</strong></div>'; }
		else 
			return '<div class="hoverinfo"><strong>' + a.properties.name + '<br>'+'Freedom Score:'+b.numberOfThings+'</strong></div>'
    },
	},
    done: this._handleMapReady.bind(this)
	});
}

Datamap.prototype._handleMapReady = function(datamap) {
	this.zoom = new Zoom({
  	$container: this.$container,
  	datamap: datamap
  });
}

new Datamap();

</script>
 </body>